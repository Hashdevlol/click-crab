#!/usr/bin/env node
const storage=require("./storage");const{executeCommand}=require("./executor");const VERSION="0.1.0";function showHelp(){console.log("Click Crab - CLI tool for pinning commands and paths");console.log("");console.log("Usage: cc [command] [options]");console.log("");console.log("Commands:");console.log("  pin [cmd]     Pin a command");console.log("  list          List commands");console.log("  run [id]      Run command");console.log("  unpin [id]    Remove command");console.log("  clip [path]   Clip path");console.log("  clips         List paths");console.log("  jump [id]     Output path");console.log("  unclip [id]   Remove path");console.log("  info          Show info");console.log("  help          Show help");console.log("  version       Show version");}function handlePin(args){if(args.length===0){console.error("Error: Provide a command");process.exit(1);}let cmd=args[0];let name;for(let i=1;i<args.length;i++){if(args[i]==="--name"||args[i]==="-n"){if(i+1<args.length){name=args[i+1];i++;}}}const pinned=storage.pinCommand(cmd,name);console.log("Pinned command #"+pinned.id);if(pinned.name)console.log("Name: "+pinned.name);console.log("Command: "+pinned.command);}function handleList(){const cmds=storage.listCommands();if(cmds.length===0){console.log("No pinned commands");return;}console.log("Pinned commands:");console.log("");cmds.forEach(c=>{const n=c.name?" ("+c.name+")":"";console.log(c.id+". "+c.command+n);});}async function handleRun(args){if(args.length===0){console.error("Error: Provide ID");process.exit(1);}const id=parseInt(args[0],10);if(isNaN(id)){console.error("Invalid ID");process.exit(1);}const cmd=storage.getCommand(id);if(!cmd){console.error("Command #"+id+" not found");process.exit(1);}console.log("Running: "+cmd.command);console.log("");const code=await executeCommand(cmd.command);process.exit(code);}function handleUnpin(args){if(args.length===0){console.error("Error: Provide ID");process.exit(1);}const id=parseInt(args[0],10);if(isNaN(id)){console.error("Invalid ID");process.exit(1);}if(!storage.deleteCommand(id)){console.error("Command #"+id+" not found");process.exit(1);}console.log("Removed command #"+id);}function handleClip(args){const p=args.length>0?args[0]:".";const clipped=storage.clipPath(p);console.log("Clipped path #"+clipped.id);console.log("Path: "+clipped.path);}function handleClips(){const paths=storage.listPaths();if(paths.length===0){console.log("No clipped paths");return;}console.log("Clipped paths:");console.log("");paths.forEach(p=>console.log(p.id+". "+p.path));}function handleJump(args){if(args.length===0){console.error("Error: Provide ID");process.exit(1);}const id=parseInt(args[0],10);if(isNaN(id)){console.error("Invalid ID");process.exit(1);}const p=storage.getPath(id);if(!p){console.error("Path #"+id+" not found");process.exit(1);}console.log(p.path);}function handleUnclip(args){if(args.length===0){console.error("Error: Provide ID");process.exit(1);}const id=parseInt(args[0],10);if(isNaN(id)){console.error("Invalid ID");process.exit(1);}if(!storage.deletePath(id)){console.error("Path #"+id+" not found");process.exit(1);}console.log("Removed path #"+id);}function handleInfo(){const cmds=storage.listCommands();const paths=storage.listPaths();console.log("Click Crab Storage Info");console.log("");console.log("Storage: "+storage.getStorageDir());console.log("Commands: "+cmds.length);console.log("Paths: "+paths.length);}async function main(){const args=process.argv.slice(2);if(args.length===0){showHelp();return;}const cmd=args[0];const cmdArgs=args.slice(1);switch(cmd){case"pin":handlePin(cmdArgs);break;case"list":handleList();break;case"run":await handleRun(cmdArgs);break;case"unpin":handleUnpin(cmdArgs);break;case"clip":handleClip(cmdArgs);break;case"clips":handleClips();break;case"jump":handleJump(cmdArgs);break;case"unclip":handleUnclip(cmdArgs);break;case"info":handleInfo();break;case"version":case"--version":case"-v":console.log("Click Crab v"+VERSION);break;case"help":case"--help":case"-h":showHelp();break;default:console.error("Unknown command: "+cmd);console.log("Run cc help for usage");process.exit(1);}}main().catch(err=>{console.error("Error:",err.message);process.exit(1);});